<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> PSR编程规范摘录 · Code for freedom</title><meta name="description" content="PSR编程规范摘录 - Jeffrey"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.tenpercent.top/atom.xml" title="Code for freedom"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon1.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about-me.html" target="_self" class="nav-list-link">关于</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">PSR编程规范摘录</h1><div class="post-info">Aug 27, 2017</div><div class="post-content"><p>这篇文章记录一下PHP的编程代码规范，做一个规范的PHPer。</p>
<p>PSR：即PHP Standards recommendation(PHP推荐标准)。</p>
<h2 id="PSR-1-基本的代码风格"><a href="#PSR-1-基本的代码风格" class="headerlink" title="PSR-1:基本的代码风格"></a>PSR-1:基本的代码风格</h2><ul>
<li>PHP标签： PHP标签只使用&lt;?php ?&gt;和&lt;?= ?&gt;，不得使用其他PHP标签句法。</li>
<li>编码： PHP所有文件都必须使用UTF-8字符集编码。</li>
<li>目的： 一个PHP文件可以定义符号（类、性状、函数和常量），或者执行有副作用的操作（例如，生成结果或处理数据），但是不能同时做这两件事。</li>
<li>自动加载： PHP命名空间和类必须遵守PSR-4自动加载器标准。</li>
<li>类的名称： PHP类的名称必须使用<code>CamelCase</code>这种驼峰式。</li>
<li>常量的名称：PHP常量的名称必须全部使用大写字母。如果需要，可以使用下划线把单词分开。例如：THIS_VARIABLE</li>
<li>方法的命名： PHP方法的名称必须使用<code>camelCase</code>这种驼峰式，首字母是小写的，后续的所有单词的首字母都是大写的。如：phpIsAwesome</li>
</ul>
<a id="more"></a>
<h2 id="PSR-2-严格的代码风格"><a href="#PSR-2-严格的代码风格" class="headerlink" title="PSR-2:严格的代码风格"></a>PSR-2:严格的代码风格</h2><p>PSR-2是在PSR-1的基础上进一步的要求。</p>
<ul>
<li>缩进 PSR-2推荐的规范要求是使用4个空格缩进（因为空格最可靠，在不同的代码编辑器中渲染的效果基本一致）</li>
<li>文件和代码 PHP文件的最后一行要有一个空行，而且不能使用PHP关闭标签<code>?&gt;</code>，每行末尾都不能有空格。（这些要求大多数编辑器能帮你做好）</li>
</ul>
<blockquote>
<p>注：PHP文件不写关闭标签的目的是能避免意料之外的输出错误。如果加上关闭标签<code>?&gt;</code>，而且在关闭标签后有空行。那么这个空行会被当成输出导致错误。（例如，设定HTTP头部时）</p>
</blockquote>
<ul>
<li>关键字 对于ture,false和null,PSR-2推荐这些关键字都要使用小写字母的形式。</li>
<li>命名空间 每个命名空间声明语句后面必须跟着一个空行。使用use关键字导入命名空间时，在一系列的use声明语句后要加一个空行。</li>
<li>类 PSR-2推荐类定义体的起始括号应该在类名之后新起一行写。如下代码所示：</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">example</span> </span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//类的定义</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>方法 （直接代码示例如下）</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">namespace Animals //注意这里的命名空间首字母需要大写</div><div class="line"></div><div class="line">class example</div><div class="line">&#123;</div><div class="line">    public function test($params = 1, $params = 'two')//注意这里起始括号和结束括号两边都没有空格</div><div class="line">    &#123;</div><div class="line">    	//方法的定义</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>可见性 类中的每个属性和方法都要声明可见性。<code>abstract</code>和<code>final</code>这俩关键字要放在可见性关键字前面。<code>static</code>关键字要放在可见性关键字后面。代码如下</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">example</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> $number = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">static</span>::$number++;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>控制结构 控制结构中如if else switch foreach等这些关键字后面都要有一个空格。示例代码如下</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> (a == b)&#123;  <span class="comment">//注意这里的花括号不用新起一行</span></div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>虽然现在有挺多的编辑器支持根据PSR-1和PSR-2来格式化代码了，不过这些写代码中的规范还是需要记住一下，尽量让自己的代码风格规范一些，这样在日常的工作中也方便团队交流。</p>
</blockquote>
<h2 id="PSR-3：日志记录器接口"><a href="#PSR-3：日志记录器接口" class="headerlink" title="PSR-3：日志记录器接口"></a>PSR-3：日志记录器接口</h2><p>PSR-3与前面得规范不同，它是一个接口，规定PHP日志记录器组件可以实现得方法。</p>
<p>大多数PHP框架都在某种程度上实现了日志功能。为了实现互操作性和专业化，PHP-FIG制定了PSR-3日志记录器接口。若想使用符合PSR-3规范得日志记录器，框架要做到两件重要得事：日志功能委托给第三方库实现；最终用户能选择使用他们喜欢得日志记录器组件。</p>
<h3 id="编写PSR-3日志记录器"><a href="#编写PSR-3日志记录器" class="headerlink" title="编写PSR-3日志记录器"></a>编写PSR-3日志记录器</h3><p>符合PSR-3推荐规范的PHP日志记录器组件，必须包含一个实现Psr\Log|LoggerInterface接口得PHP类。PSR-3接口复用了系统日志协议，规定要实现以下九个方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Log</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">LoggerInterface</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">emergency</span><span class="params">($message,array $context = array<span class="params">()</span>)</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">alert</span><span class="params">($message,array $context = array<span class="params">()</span>)</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">critial</span><span class="params">($message,array $context = array<span class="params">()</span>)</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">error</span><span class="params">($message,array $context = array<span class="params">()</span>)</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">warning</span><span class="params">($message,array $context = array<span class="params">()</span>)</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notice</span><span class="params">($message,array $context = array<span class="params">()</span>)</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">info</span><span class="params">($message,array $context = array<span class="params">()</span>)</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">debug</span><span class="params">($message,array $context = array<span class="params">()</span>)</span></span>;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span><span class="params">($level,$message,array $context = array<span class="params">()</span>)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是，我们现在已经不需要自己去编写一个日志记录器了，因为已经有了<strong>Monolog</strong>(可访问packagist这个网站查看介绍)这个十分出色的PHP日志记录器组件了，它几乎提供了开发过程中所有需要的功能。</p>
<h2 id="PSR-4：自动加载器"><a href="#PSR-4：自动加载器" class="headerlink" title="PSR-4：自动加载器"></a>PSR-4：自动加载器</h2><p>PSR-4描述了一个标准的自动加载器策略。自动加载器策略是指，在运行时按需查找PHP类、接口或者性状，并将其载入PHP解释器。支持PSR-4自动加载器标准的PHP组件和框架，使用同一个自动加载器就能找到相关代码</p>
<p>在PHP-FIG发布PSR-4推荐规范之前，PHP组件和框架的作者使用<code>__autoload()</code>和<code>spl_autoload_register()</code>函数注册自定义的自动加载器策略。可是，每个PHP组件和框架都使用独特的自动加载器，而且每个加载器使用不同的逻辑查找并加载PHP类、性状和接口。使用这些组件和框架的开发者，在引导PHP应用时必须调用每个组件各自的自动加载器时必须调用每个组件各自的自动加载器。这样在开发中很麻烦。</p>
<p>如今，得益于PSR-4，我们只需要使用一个自动加载器就能自动加载应用中的所有PHP组件。大多数现代的PHP组件和框架都符合PSR-4规范。</p>
<h3 id="PSR自动加载策略"><a href="#PSR自动加载策略" class="headerlink" title="PSR自动加载策略"></a>PSR自动加载策略</h3><p>PSR-4自动加载策略依赖PHP命名空间和文件系统目录结构查找并加载PHP类、接口，性状。</p>
<p>它的精髓是把命名空间的前缀和文件系统中的目录对应起来。例如，<code>\Oreilly\ModernPHP\Chapter1</code>命名空间对应与<code>src/chapter1</code>目录，<code>\Oreilly\ModernPHP\Chapter1\Example</code>类对应于<code>src/Chapter1/Example</code>。</p>
<h3 id="实现一个PSR-4自动加载器"><a href="#实现一个PSR-4自动加载器" class="headerlink" title="实现一个PSR-4自动加载器"></a>实现一个PSR-4自动加载器</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* 该代码中，使用SPL注册这个自动加载函数后，遇到下述代码时，这个函数会</div><div class="line">* 自动尝试从/path/to/project/src/Baz/Qux.php文件中加载</div><div class="line">* \Foo\Bar\Baz\Quz类：</div><div class="line">*    new \Foo\Bar\Baz\Qux;</div><div class="line">*    </div><div class="line">*/</div><div class="line"></div><div class="line">spl_autpload_register(<span class="function"><span class="keyword">function</span> <span class="params">($class)</span>)</span>&#123;</div><div class="line">	<span class="comment">//这个项目的命名空间前缀</span></div><div class="line">	$prefix = <span class="string">'Foo\\Bar\\'</span>;</div><div class="line">	</div><div class="line">	<span class="comment">//这个命名空间对应的根目录；</span></div><div class="line">	$base_url = <span class="keyword">__DIR__</span>.<span class="string">'/src/'</span>;</div><div class="line">		</div><div class="line">	<span class="comment">//参数传入的类使用这个命名空间前缀吗？</span></div><div class="line">	$len = strlen($prefix);</div><div class="line">	<span class="keyword">if</span>(strncmp($prefix, $class, $len) !==<span class="number">0</span>)&#123;</div><div class="line">		<span class="comment">//不使用，交给注册的下一个自动加载器处理</span></div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">//获取去掉前缀后的类名</span></div><div class="line">	$relative_class = substr($class, $len);</div><div class="line">	</div><div class="line">	<span class="comment">//把命名空间前缀替换成根目录，</span></div><div class="line">	<span class="comment">//去掉前缀的类命中，把命名空间分隔符替换成目录分隔符，</span></div><div class="line">	<span class="comment">//然后再后面加上.php</span></div><div class="line">	$file = $base_dir.str_replace(<span class="string">'\\'</span>, <span class="string">'/'</span>, $relative_class).<span class="string">'.php'</span>;</div><div class="line">	</div><div class="line">	<span class="comment">//如果文件存在，将其导入</span></div><div class="line">	<span class="keyword">if</span>(file_exists($file))&#123;</div><div class="line">	    <span class="keyword">require</span> $file;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码是一个PSR-4自动加载器的逻辑。不过在现在，我们也无须自己编写一个PSR-4自动加载器了，因为我们可以使用依赖管理器<strong>Composer</strong>自动生成PSR-4自动加载器。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/09/03/use-vagrant/" class="prev">上一篇</a><a href="/2017/08/13/php-standard/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'cjh';
var disqus_identifier = '2017/08/27/PSR-reference/';
var disqus_title = 'PSR编程规范摘录';
var disqus_url = 'http://www.tenpercent.top/2017/08/27/PSR-reference/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//cjh.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 - 2019 <a href="http://www.tenpercent.top">Jeffrey</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-146782675-1",'auto');ga('send','pageview');</script></body></html>